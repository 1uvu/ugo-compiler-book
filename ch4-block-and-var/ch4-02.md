# 4.2 完善AST和解析器

Token类型和词法解析的准备工作都就绪了，本节我们将继续完善AST结点定义和语法树的解析工作。

## 4.2.1 完善AST结点

新增加的VAR和ASSIGN两个Token类型分别对应2个新的语法树结点。

新增 `VarSpec` 类型表示变量的定义：

```go
// 变量信息
type VarSpec struct {
	VarPos token.Pos // var 关键字位置
	Name   *Ident    // 变量名字
	Type   *Ident    // 变量类型, 可省略
	Value  Expr      // 变量表达式
}
```

其中重要的信息时变量的名字，变量的类型和变量的初始化值。初始化表达式是一个 Expr 表达式接口类型，可以为空。有初始化表达式时，类型也可以为空。

然后新增加 `AssignStmt` 表示一个赋值语句（目前只支持一个变量的赋值）：

```go
type AssignStmt struct {
	Target *Ident          // 要赋值的目标
	OpPos  token.Pos       // Op 的位置
	Op     token.TokenType // '='
	Value  Expr            // 值
}
```

其中Target表示被赋值的目标，Value是值表达式，Op表示赋值的操作符号。目前Op只有`=`一种情况，之所以添加Op是为了后面支持`:=`简短定义赋值的语法，目前可以忽略。

最后File增加全局变量的信息：

```go
type File struct {
	Filename string // 文件名
	Source   string // 源代码

	Pkg     *PackageSpec // 包信息
	Globals []*VarSpec   // 全局变量
	Funcs   []*Func      // 函数列表
}
```

为了好区分，我们将Package类型改名为PackageSpec类型。Globals表示全局变量列表。Funcs依然是函数列表。

## 4.2.2 完善嵌套的块语句解析

在第3章的例子中我们已经可以实现多个语句的解析，但是还不支持嵌套块语句的解析。比如以下的代码：

```go
func main() {
	println(1)
	{
		println(1000 + 123)
	}
	println(40 + 2)
}
```

在解析内层的块语句时会出现`unknown tok: type={, lit="{"`错误。

TODO

## 4.2.3 变量定义解析

TODO
